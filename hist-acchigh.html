<!DOCTYPE html>
<html>

<head>
    <!-- Load plotly.js into the DOM -->
    <script src='https://cdn.plot.ly/plotly-2.11.1.min.js'></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>histogram representation</title>

    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="https://unpkg.com/d3-simple-slider"></script>
    <script src='https://cdn.plot.ly/plotly-2.9.0.min.js'></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous" />

</head>

<body>

    <div id="container" class="container">
        <div class="row align-items-center">
            <div id='myDiv' style="margin: 0 auto;">
            </div>
        </div>
    <div class="row align-items-center">
        <!-- <div class="col-sm-2"><p id="value-simple"></p></div> -->
        <div class="col" style="text-align: center;">
            <div id="slider-simple"></div>
        </div>
    </div>

    <script>
        //slider


        // var rangeData = [5.0, 4.0, 3.0, 2.0, 1.0, 0.1, 0.05, 0.01]
        
        var population = []

        // Slider
        var rangeData = [ 5.0, 0.05, 0.01]
        var sliderSimple = d3
            .sliderBottom()
            .min(d3.min(rangeData))
            .max(d3.max(rangeData))
            .width(400)
            .tickFormat(d3.format('.2'))
            .ticks(11)
            .default(d3.max(rangeData))
            .on('onchange', val => {
                // Event of sliding
                // Empty and fill the population list with random data
                trace3.y = get_noisy_data(val)
                trace2.y = get_area_y(val)
                Plotly.redraw('myDiv');
            });

        var gSimple = d3
            .select('div#slider-simple')
            .append('svg')
            .attr('width', 500)
            .attr('height', 100)
            .append('g')
            .attr('transform', 'translate(30,30)');

        gSimple.call(sliderSimple);

        d3.select('p#value-simple').text(d3.format('.2%')(sliderSimple.value()));




        //data

        var zip_codes = [10006, 10004, 11109, 10280, 10069, 10007, 10005, 10282, 11363, 11697, 10464, 10017, 10012, 10018, 10044, 10038, 10013, 10010, 10014, 11362, 11360, 10474, 11693, 10065, 10022, 10001, 10307, 11366, 10036, 11231, 10075, 11222, 10003, 10470, 11361, 11364, 10028, 11105, 11104, 11426, 10030, 10039, 11239, 11436, 10011, 11232, 11415, 10037, 11356, 10023, 10021, 11358, 11103, 11004, 10019, 11692, 11102, 11217, 11215, 11101, 10308, 10128, 10302, 10026, 11106, 11228, 11428, 11411, 10016, 10009, 10024, 11201, 11694, 10034, 11416, 10310, 11205, 11216, 11378, 11427, 11238, 10471, 11414, 11379, 11357, 11365, 10309, 10303, 11417, 11429, 11433, 10035, 11422, 11237, 10027, 11367, 10002, 11374, 11423, 11418, 10040, 10454, 11209, 11225, 11224, 10301, 11354, 11421, 11419, 10305, 11412, 11233, 10455, 11355, 11221, 10031, 11413, 11370, 10025, 10033, 11420, 10304, 11213, 10306, 10465, 10459, 10312, 11375, 10032, 11214, 11220, 11206, 10451, 11369, 11435, 10460, 11210, 10475, 11223, 11218, 11229, 11432, 10029, 10461, 11212, 10473, 10472, 10463, 11204, 10458, 11235, 11203, 11211, 11207, 11434, 10457, 11385, 11377, 11234, 11226, 10462, 11691, 10453, 11230, 11208, 10466, 10452, 10456, 11372, 10314, 11236, 10468, 10469, 11219, 11373, 10467, 11368]
        var positive_cases = [24, 31, 48, 52, 54, 58, 61, 71, 98, 108, 118, 143, 162, 204, 235, 250, 261, 267, 299, 312, 316, 323, 326, 330, 338, 365, 378, 389, 416, 423, 425, 442, 450, 450, 452, 463, 468, 488, 492, 499, 500, 516, 517, 519, 521, 528, 534, 539, 552, 558, 561, 566, 574, 584, 598, 604, 609, 614, 621, 626, 631, 631, 633, 639, 641, 669, 674, 681, 686, 689, 691, 696, 700, 707, 708, 718, 723, 733, 734, 778, 781, 791, 797, 800, 811, 827, 838, 870, 882, 941, 943, 950, 969, 969, 1026, 1030, 1053, 1069, 1073, 1085, 1111, 1126, 1128, 1141, 1169, 1176, 1185, 1187, 1192, 1228, 1233, 1256, 1266, 1275, 1304, 1312, 1312, 1327, 1338, 1344, 1345, 1380, 1391, 1448, 1478, 1483, 1494, 1496, 1511, 1535, 1539, 1602, 1603, 1605, 1615, 1635, 1681, 1695, 1707, 1721, 1768, 1804, 1812, 1867, 1870, 1918, 1944, 2009, 2028, 2034, 2038, 2070, 2073, 2076, 2078, 2082, 2152, 2227, 2239, 2252, 2263, 2328, 2353, 2354, 2379, 2385, 2393, 2477, 2506, 2639, 2702, 2739, 2988, 3047, 3112, 3273, 3324]
        var idx = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176]
        // var area_x = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 99, 100, 101, 102, 103, 104, 105, 106, 107, 108, 109, 110, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 124, 125, 126, 127, 128, 129, 130, 131, 132, 133, 134, 135, 136, 137, 138, 139, 140, 141, 142, 143, 144, 145, 146, 147, 148, 149, 150, 151, 152, 153, 154, 155, 156, 157, 158, 159, 160, 161, 162, 163, 164, 165, 166, 167, 168, 169, 170, 171, 172, 173, 174, 175, 176, 176, 175, 174, 173, 172, 171, 170, 169, 168, 167, 166, 165, 164, 163, 162, 161, 160, 159, 158, 157, 156, 155, 154, 153, 152, 151, 150, 149, 148, 147, 146, 145, 144, 143, 142, 141, 140, 139, 138, 137, 136, 135, 134, 133, 132, 131, 130, 129, 128, 127, 126, 125, 124, 123, 122, 121, 120, 119, 118, 117, 116, 115, 114, 113, 112, 111, 110, 109, 108, 107, 106, 105, 104, 103, 102, 101, 100, 99, 98, 97, 96, 95, 94, 93, 92, 91, 90, 89, 88, 87, 86, 85, 84, 83, 82, 81, 80, 79, 78, 77, 76, 75, 74, 73, 72, 71, 70, 69, 68, 67, 66, 65, 64, 63, 62, 61, 60, 59, 58, 57, 56, 55, 54, 53, 52, 51, 50, 49, 48, 47, 46, 45, 44, 43, 42, 41, 40, 39, 38, 37, 36, 35, 34, 33, 32, 31, 30, 29, 28, 27, 26, 25, 24, 23, 22, 21, 20, 19, 18, 17, 16, 15, 14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2, 1, 0, 0]
        // var area_y = [323.573227355399, 330.573227355399, 347.573227355399, 351.573227355399, 353.573227355399, 357.573227355399, 360.573227355399, 370.573227355399, 397.573227355399, 407.573227355399, 417.573227355399, 442.573227355399, 461.573227355399, 503.573227355399, 534.573227355399, 549.573227355399, 560.573227355399, 566.573227355399, 598.573227355399, 611.573227355399, 615.573227355399, 622.573227355399, 625.573227355399, 629.573227355399, 637.573227355399, 664.573227355399, 677.573227355399, 688.573227355399, 715.573227355399, 722.573227355399, 724.573227355399, 741.573227355399, 749.573227355399, 749.573227355399, 751.573227355399, 762.573227355399, 767.573227355399, 787.573227355399, 791.573227355399, 798.573227355399, 799.573227355399, 815.573227355399, 816.573227355399, 818.573227355399, 820.573227355399, 827.573227355399, 833.573227355399, 838.573227355399, 851.573227355399, 857.573227355399, 860.573227355399, 865.573227355399, 873.573227355399, 883.573227355399, 897.573227355399, 903.573227355399, 908.573227355399, 913.573227355399, 920.573227355399, 925.573227355399, 930.573227355399, 930.573227355399, 932.573227355399, 938.573227355399, 940.573227355399, 968.573227355399, 973.573227355399, 980.573227355399, 985.573227355399, 988.573227355399, 990.573227355399, 995.573227355399, 999.573227355399, 1006.573227355399, 1007.573227355399, 1017.573227355399, 1022.573227355399, 1032.573227355399, 1033.573227355399, 1077.573227355399, 1080.573227355399, 1090.573227355399, 1096.573227355399, 1099.573227355399, 1110.573227355399, 1126.573227355399, 1137.573227355399, 1169.573227355399, 1181.573227355399, 1240.573227355399, 1242.573227355399, 1249.573227355399, 1268.573227355399, 1268.573227355399, 1325.573227355399, 1329.573227355399, 1352.573227355399, 1368.573227355399, 1372.573227355399, 1384.573227355399, 1410.573227355399, 1425.573227355399, 1427.573227355399, 1440.573227355399, 1468.573227355399, 1475.573227355399, 1484.573227355399, 1486.573227355399, 1491.573227355399, 1527.573227355399, 1532.573227355399, 1555.573227355399, 1565.573227355399, 1574.573227355399, 1603.573227355399, 1611.573227355399, 1611.573227355399, 1626.573227355399, 1637.573227355399, 1643.573227355399, 1644.573227355399, 1679.573227355399, 1690.573227355399, 1747.573227355399, 1777.573227355399, 1782.573227355399, 1793.573227355399, 1795.573227355399, 1810.573227355399, 1834.573227355399, 1838.573227355399, 1901.573227355399, 1902.573227355399, 1904.573227355399, 1914.573227355399, 1934.573227355399, 1980.573227355399, 1994.573227355399, 2006.573227355399, 2020.573227355399, 2067.573227355399, 2103.573227355399, 2111.573227355399, 2166.573227355399, 2169.573227355399, 2217.573227355399, 2243.573227355399, 2308.573227355399, 2327.573227355399, 2333.573227355399, 2337.573227355399, 2369.573227355399, 2372.573227355399, 2375.573227355399, 2377.573227355399, 2381.573227355399, 2451.573227355399, 2526.573227355399, 2538.573227355399, 2551.573227355399, 2562.573227355399, 2627.573227355399, 2652.573227355399, 2653.573227355399, 2678.573227355399, 2684.573227355399, 2692.573227355399, 2776.573227355399, 2805.573227355399, 2938.573227355399, 3001.573227355399, 3038.573227355399, 3287.573227355399, 3346.573227355399, 3511.573227355399, 3672.573227355399, 4823.573227355399, 4224.426772644601, 3073.426772644601, 2912.426772644601, 2747.426772644601, 2688.426772644601, 2439.426772644601, 2402.426772644601, 2339.426772644601, 2206.426772644601, 2177.426772644601, 2093.426772644601, 2085.426772644601, 2079.426772644601, 2054.426772644601, 2053.426772644601, 2028.426772644601, 1963.426772644601, 1952.426772644601, 1939.426772644601, 1927.426772644601, 1852.426772644601, 1782.426772644601, 1778.426772644601, 1776.426772644601, 1773.426772644601, 1770.426772644601, 1738.426772644601, 1734.426772644601, 1728.426772644601, 1709.426772644601, 1644.426772644601, 1618.426772644601, 1570.426772644601, 1567.426772644601, 1512.426772644601, 1504.426772644601, 1468.426772644601, 1421.426772644601, 1407.426772644601, 1395.426772644601, 1381.426772644601, 1335.426772644601, 1315.426772644601, 1305.426772644601, 1303.426772644601, 1302.426772644601, 1239.426772644601, 1235.426772644601, 1211.426772644601, 1196.426772644601, 1194.426772644601, 1183.426772644601, 1178.426772644601, 1148.426772644601, 1091.426772644601, 1080.426772644601, 1045.426772644601, 1044.426772644601, 1038.426772644601, 1027.426772644601, 1012.426772644601, 1012.426772644601, 1004.426772644601, 975.426772644601, 966.426772644601, 956.426772644601, 933.426772644601, 928.426772644601, 892.426772644601, 887.426772644601, 885.426772644601, 876.426772644601, 869.426772644601, 841.426772644601, 828.426772644601, 826.426772644601, 811.426772644601, 785.426772644601, 773.426772644601, 769.426772644601, 753.426772644601, 730.426772644601, 726.426772644601, 669.426772644601, 669.426772644601, 650.426772644601, 643.426772644601, 641.426772644601, 582.426772644601, 570.426772644601, 538.426772644601, 527.426772644601, 511.426772644601, 500.426772644601, 497.426772644601, 491.426772644601, 481.426772644601, 478.426772644601, 434.426772644601, 433.426772644601, 423.426772644601, 418.426772644601, 408.426772644601, 407.426772644601, 400.426772644601, 396.426772644601, 391.426772644601, 389.426772644601, 386.426772644601, 381.426772644601, 374.426772644601, 369.426772644601, 341.426772644601, 339.426772644601, 333.426772644601, 331.426772644601, 331.426772644601, 326.426772644601, 321.426772644601, 314.426772644601, 309.426772644601, 304.426772644601, 298.426772644601, 284.426772644601, 274.426772644601, 266.426772644601, 261.426772644601, 258.426772644601, 252.426772644601, 239.426772644601, 234.426772644601, 228.426772644601, 221.426772644601, 219.426772644601, 217.426772644601, 216.426772644601, 200.426772644601, 199.426772644601, 192.426772644601, 188.426772644601, 168.426772644601, 163.426772644601, 152.426772644601, 150.426772644601, 150.426772644601, 142.426772644601, 125.42677264460099, 123.42677264460099, 116.42677264460099, 89.42677264460099, 78.42677264460099, 65.42677264460099, 38.42677264460099, 30.426772644600987, 26.426772644600987, 23.426772644600987, 16.426772644600987, 12.426772644600987, -0.5732273553990126, -32.57322735539901, -38.57322735539901, -49.57322735539901, -64.57322735539901, -95.57322735539901, -137.573227355399, -156.573227355399, -181.573227355399, -191.573227355399, -201.573227355399, -228.573227355399, -238.573227355399, -241.573227355399, -245.573227355399, -247.573227355399, -251.573227355399, -268.573227355399, -275.573227355399, 323.573227355399]
        var area_y = get_area_y(d3.max(rangeData))

        //area_x
        var x = Array.apply(null, { length: zip_codes.length }).map(eval.call, Number)
        area_x = x.concat([...x].reverse())

        noisy_data = get_noisy_data(d3.max(rangeData))

        function get_area_y(ep) {

            var shade = (-1 * Math.log(1 - 0.95) / ep)
            var upper_bound = positive_cases.map((positive_case) => (positive_case + shade))
            var lower_bound = positive_cases.map((positive_case) => (positive_case - shade)).reverse()
            area_y = upper_bound.concat(lower_bound)
            area_y.push(upper_bound[0])
            return area_y

        }

        function get_area_x() {
            //range like code here

        }


        function sgn(x) {
            return x < 0 ? -1 : 1;
        }

        // From wikipedia:
        // Lap(X) = mu - b sgn(U) ln (1-2|U|) where U is a random variable between -0.5 and 0.5
        function laplace(mu, b) {
            var U = Math.random() - 0.5;
            return mu - (b * sgn(U) * Math.log(1 - 2 * Math.abs(U)));
        }

        function privatize(F, epsilon, deltaF = 1) {
            return F + laplace(0.0, deltaF / epsilon);
        }
        function get_noisy_data(eps) {
            return positive_cases.map(item => { return privatize(item, eps) })

        }

        t=idx.map((item) => {return `Original Covid+ cases: ${positive_cases[item]} <br></br>Zip code: ${zip_codes[item]}`})
        console.log(t)
        var trace1 = {
            x: idx,
            y: positive_cases,
            mode: 'lines',
            type: 'scatter',
            line: {
                color: 'royalblue',
                width: 2
            },
            name: 'original data',
            hoverinfo: 'skip'
        };

        var trace2 = {
            x: area_x,
            y: area_y,
            mode: 'none',
            type: 'scatter',
            fill: 'toself',
            name: 'error bound',
            hoverinfo: 'skip',
            color: '#fff877'
        };

        var trace3 = {
            x: idx,
            y: noisy_data,
            mode: 'lines',
            type: 'scatter',
            line: {
                color: 'black',
                width: 2,
                dash: 'dot'
            },
            name: 'noisy data',
            hovertemplate: 'Noisy    Covid+ cases: %{y:.2f}' +
                        '<br>%{text}</br>'+
                        '<extra></extra>',
            text: t,
            
        };

        var data = [trace1, trace2, trace3];

        var layout = {
            showlegend: true,
            legend: {
                orientation: 'h'
            },

            // hovermode : "x unified",


            hoverlabel: { 
                bgcolor: 'rgba(255,255,255,0.75)',
            },
            yaxis: {
                range: [-200, 3500]
            
            },

            xaxis: {
                tickmode: "array",
                tickvals: idx, //real idx should be fed here
                ticktext: zip_codes,
                visible: false
            }
        };
        Plotly.newPlot('myDiv', data, layout);



    </script>
</body>

</html>